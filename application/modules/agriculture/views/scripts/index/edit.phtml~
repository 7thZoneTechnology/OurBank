<!--
############################################################################
#  This file is part of OurBank.
############################################################################
#  OurBank is free software: you can redistribute it and/or modify
#  it under the terms of the GNU Affero General Public License as
#  published by the Free Software Foundation, either version 3 of the
#  License, or (at your option) any later version.
############################################################################
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU Affero General Public License for more details.
############################################################################
#  You should have received a copy of the GNU Affero General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
############################################################################
!-->
<html>
  <head>

     <script type='text/javascript' src="<?php  echo $this->baseUrl();?>/js/jquery-1.3.2.js"></script>
    <script type='text/javascript' src="<?php  echo $this->baseUrl();?>/js/jquery.validate.js"></script>
<script type='text/javascript' src="<?php  echo $this->baseUrl();?>/js/jqueryAddmethod.js"></script>

<script type='text/javascript'>






 
$(document).ready(
  function() {
  $("#pluginForm").validate();
  

  
   $('input#tmpAddRow').click(
      function() {

      tableobj=$(this).parent();
        selectedval=[];
     var newRow = $('tr#tmp').clone(true).removeAttr('id');
                selectobj=newRow.find("select");
                newrowobj=$(this).children(':first');
                inputobj=newRow.find("input:text");
                inputobj.val("");
        newRow.appendTo('.asset tbody');

//This is for removing option
//       rowindex=$('tr',tableobj).length;
//       trobjec=$('tr',tableobj);
//        $('tr',tableobj).each(function (index, domEle) {
//            if(index!=rowindex && index!=0)
//              {
//               sval=$("#select"+index).selectedValues();
//                selectedval.push(sval);}
//         });
//      
//         $(selectobj).attr('id', 'select'+rowindex);
//              trobjec.each(function (index, domEle) {
//                    if(index!=0 && index!=rowindex)
//                      {
//                       sval=$("#select"+index).selectedValues();
//            alert(sval);
//                     $("#select"+rowindex+" option[value='"+sval+"']").remove();
//                 }
    });

 $('.select').change(function(){
            if($(this).val() == 'Select'){
                    $(this).after('<span style="color: #FF0000">Choose proper Asset</span>');
            } else {
                    $(this).next('span').remove();
            }
    });


           $('tr#tmp').closest('table').find('input:text.date').each(function() {
            $(this).removeClass('hasDatepick').datepick({dateFormat: 'dd/mm/yyyy',maxDate : '+0D',});        });
   

 
    $('tr input[type=text]').focus(
      function() {
        $(this).addClass('myFocused');   
      }
    ).blur(
      function() {
        $(this).removeClass('myFocused');
      }
    );

  $('.delete-icon').click(function() {
        $(this).closest('tr').not('#tmp').remove();
    });   
  
   $('#pluginForm').submit(function(e) {
        $(this).find(':text.required').each(function() {
            if($(this).val().replace(/^\s+|\s+$/g,"") == "") {
                if($(this).next('span').length == 0 )
                    $(this).after('<span style="color: #FF0000">Field is required</span>');
                e.preventDefault();
                return;
            } else {
                if($(this).next('span').length > 0 )
                    $(this).next('span').remove();
            }
        });

     $(this).find(':select.selectvalid').each(function() {
            if($(this).val() == 0) {
                if($(this).next('span').length == 0 ){
                    $(this).after('<span style="color: #FF0000">Field is required</span>');
                e.preventDefault();
                return;
                }
             }   else {
                if($(this).next('span').length > 0 )
                    $(this).next('span').remove();
                }
        });

        $(this).find(':text.numeric').each(function() {
           var regex = new RegExp(/^[1-9][0-9]*$/);
           if(!regex.test($(this).val()) && $(this).val() != "") {
               if($(this).next('span').length == 0 ) {
                  $(this).after('<span style="color: #FF0000">Numeric Data allowed only.</span>');
               }
               e.preventDefault();
               return;
           } else {
                   $(this).next('span').remove();
           }
       });


    });

      
  
    
    
      }
    );
    </script>
    <style>
    label.error{
    clear:both;
    color:red;
    float:left;
    }
    </style>
</head>
<body>
  <table id="hor-minimalist-b" border="1" bgcolor="#F8F8F8">
   <tr>
        <th><?php echo $this->translate("Family information"); ?></th>
        <th></th>
        <th></th>
        <th></th>
   </tr>
    <?php 
    $convertdate = new App_Model_dateConvertor();
    foreach($this->membername as $family_view){ ?>

    <tr>
        <td ><?php echo $this->translate("Family ID:"); ?></td>
        <td ><?php echo $family_view['family_id']; ?></td>
        <td ><?php echo $this->translate("Caste:"); ?></td>
        <td ><?php echo $family_view['subcaste']; ?></td>    </tr>
    <tr>
        <td ><?php echo $this->translate("House No:"); ?></td>
        <td ><?php echo $family_view['house_no']; ?></td>
        <td ><?php echo $this->translate("Ration card:"); ?></td>
        <td ><?php echo $family_view['ration']; ?></td>
    </tr>

    <tr>
        <td ><?php echo $this->translate("Street/Road/Lane:"); ?></td>
        <td ><?php echo $family_view['street']; ?></td>
        <td ><?php echo $this->translate("Health Insurance:"); ?></td>
        <td ><?php foreach($this->insurance as $insurance){ echo $insurance['insurancename']; echo "<br>";
        }?></td>
    </tr>

    <tr>
        <td ><?php echo $this->translate("Colony/Village:"); ?></td>
        <td ><?php echo $family_view['villagename']; ?></td>
        <td ><?php echo $this->translate("NREGS Job Card No:"); ?></td>
        <td ><?php echo $family_view['nregs_jobno']; ?></td>    </tr>

    <tr>
        <td ><?php echo $this->translate("Rev Village:"); ?></td>
        <td ><?php echo $this->revvillagename; ?></td>
        <td ><?php echo $this->translate("Major source of income:"); ?></td>
        <td ><?php echo $family_view['income']; ?></td>
    </tr>
    <tr>
        <td ><?php echo $this->translate("Family type:"); ?></td>
        <td ><?php echo $family_view['familytype']; ?></td>
        <td ><?php echo $this->translate("Contact Phone:"); ?></td>
        <td ><?php echo $family_view['mobile']; ?></td>
    </tr>

    <tr>
        <td ><?php echo $this->translate("Category:"); ?></td>
        <td ><?php echo $family_view['caste']; ?></td>
        <td ><?php echo $this->translate("Mobile:"); ?></td>
        <td ><?php echo $family_view['mobile']; ?></td>
    </tr>
   <?php } ?>
</table> 
<br/>
<div style="height:250px; width:750px; overflow-x:scroll ; overflow-y: scroll; padding-bottom:10px;">
<form  id="pluginForm" action="<?php echo $this->baseUrl();?>/agriculture/index/edit/id/<?php echo $this->memberid; ?>" method="POST">
<table id="hor-minimalist-b" class="crop asset" <?php $records=sizeof($this->agriculture); $emt=0; $i =0;  ?>>
<tr> 
    <th><?php echo $this->translate("Land holding"); ?></th>
    <th><?php echo $this->translate("Acquistion type"); ?></th>

    <th><?php echo $this->translate("Acre"); ?></th>
    <th><?php echo $this->translate("Gunta"); ?></th>
    <th><?php echo $this->translate("Owner name"); ?></th>
    <th><?php echo $this->translate("Survey no"); ?></th>
    <th><?php echo $this->translate("Village"); ?></th>
    <th>Action</th>
</tr>


<?php if( $records== $emt) { ?>
<tr id='tmp'>
            <td <?php $i = 1;  ?>><select name = tenant[] id="select<?php echo $i++; ?>" class="selectvalid required" >
                    <option value=0>Select</option>

                            <?php foreach ($this->land_details as $land_details) { ?>
                            <option value="<?php echo $land_details['id']?>"><?php echo $land_details['name']?></option>
                            <?php } ?>
                        </select>
            </td>  
<td><select name = acquistion[] class="selectvalid">
                    <option value=0>Select</option>

                            <?php foreach ($this->acquistion as $acquistion) { ?>
                            <option value="<?php echo $acquistion['id']?>"><?php echo $acquistion['name']?></option>
                            <?php } ?>
                        </select>
            </td>
			<td><INPUT type="text" name = "acre[]" size="5" required_group="eithergroup" class="numeric eithergroup"  maxlength="3" ></td>
            <td><INPUT type="text" name = "gunta[]" size="5" class="acre number eithergroup error" min="0" max="39"></td>
 			<td><select name = ownername[] class="selectvalid">
			<?php foreach ($this->owner as $owner) { ?>
                    <option value=0>Select</option>

			<option value="<?php echo $owner['landowner_name']?>"><?php echo $owner['name']?></option>
			<?php } ?>
                            </select>
            </td> 
            <td><INPUT type="text" name = "survey[]" size="5" maxlength="8" class="noSpecialChars"></td>
								<td><select name = villagename[] class="selectvalid">
                    <option value=0>Select</option>


                                <?php foreach ($this->village as $village) { ?>
                                <option value="<?php echo $village['id']?>"><?php echo $village['name']?></option>
                                <?php } ?>
                            </select>
            </td> 
            <td><img class="delete-icon" alt="delete" src="<?php echo $this->baseUrl(); ?>/images/delete.gif" border=0 width='16' height='16'></td>
        </tr>
 <?php } ?>
           
            <?php
                foreach ($this->agriculture as $agri) { $i++; ?>
                <tr<?php if ($i==1) { ?> id="tmp" <?php } ?>>

              <td><select name = "tenant[]">
               
                    <OPTION value="<?php echo $agri["land_id"]; ?>">
                    <?php echo $agri["landtypename"]; ?>
                    </OPTION>
                    <?php foreach ($this->land_details as $assetdetails) {  ?>
                        <? if($agri["landtypename"] != $assetdetails["name"] ) {?>
                           <option value="<?php echo $assetdetails['id']?>"><?php echo $assetdetails['name']?></option>
                    <?php } } $dateconvert= new App_Model_dateConvertor();
					?></select></td>
  <td><select name = "acquistion[]">
               
                    <OPTION value="<?php echo $agri["acquistion_id"]; ?>">
                    <?php echo $agri["ownership"]; ?>
                    </OPTION>
                    <?php foreach ($this->acquistion as $acquistion) {  ?>
                        <? if($agri["ownership"] != $acquistion["name"] ) {?>
                           <option value="<?php echo $acquistion['id']?>"><?php echo $acquistion['name']?></option>
                    <?php } } $dateconvert= new App_Model_dateConvertor();
					?></select></td>
                    <td><INPUT type="text" name = "acre[]" size="5" required_group="eithergroup" class="number eithergroup" maxlength="3" value = "<?php echo $agri["acre"];?>"></td>
            <td><INPUT type="text" name = "gunta[]" size="5" class="acre number eithergroup error" maxlength="2" min="0" max="39" value="<?php echo $agri["gunta"]; ?>"></td>


          <td><select name = "ownername[]">
               
                    <OPTION value="<?php echo $agri["landowner_name"]; ?>">
                    <?php echo $agri["ownername"]; ?>
                    </OPTION>
                    <?php foreach ($this->owner as $owner) {  ?>
                        <? if($agri["ownername"] != $owner["name"] ) {?>
                           <option value="<?php echo $owner['id']?>"><?php echo $owner['name']?></option>
                    <?php } } $dateconvert= new App_Model_dateConvertor();
					?></select></td>

            <td><INPUT type="text" name = "survey[]" size="5" class="noSpecialChars" maxlength="8" value = "<?php echo $agri["survey_no"];?>"></td>
  <td><select name = "villagename[]">
               
                    <OPTION value="<?php echo $agri["villagename"]; ?>">
                    <?php echo $agri["village"]; ?>
                    </OPTION>
                    <?php foreach ($this->village as $village) {  ?>
                        <? if($agri["village"] != $village["village"] ) {?>
                           <option value="<?php echo $village['id']?>"><?php echo $village['name']?></option>
                    <?php } } $dateconvert= new App_Model_dateConvertor();
					?></select></td>
            </td> 
           
            <td><img class="delete-icon" alt="delete" src="<?php echo $this->baseUrl(); ?>/images/delete.gif" border=0 width='16' height='16'></td>
        </tr>
        <?php } ?>
    </table> 

 <input type="button" id="tmpAddRow" name="Add" value="<?php echo $this->translate("Add"); ?>"  >
    <input type="submit" id="submit" name="submit" value="<?php echo $this->translate("Submit"); ?>"><a href="<? echo $this->baseUrl();?>/familycommonview/index/commonview/id/<? echo $this->memberid ?>"><input type="button" id="submit" name="submit" value="<?php echo $this->translate("Back"); ?>"></a>
    </form>
</div>
</body>
</html>